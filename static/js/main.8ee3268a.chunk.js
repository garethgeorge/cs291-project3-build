(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{22:function(e,t,a){e.exports=a(51)},27:function(e,t,a){},28:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){},51:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(9),o=a.n(r),c=(a(27),a(4)),i=a(5),l=a(7),u=a(6),m=a(8),d=(a(28),a(29),a(3)),h=a(1),g=a(10),p=a.n(g),b=a(11),f=a.n(b),v={API_Host:"http://localhost:5000"},E={user:null,connectedToChat:!1,connectedUsers:[],messages:[]},O=Object(h.l)(Object.assign({},E)),y={};y.state=O,y.formatDate=function(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")},y.logout=Object(h.d)((function(e){Object.assign(y.state,E)})),y.disconnect=Object(h.d)((function(){y.state.connectedToChat=!1,y.state.connectedUsers=[]})),y.connectToChat=function(e){var t=new EventSource(e);t.addEventListener("Disconnect",Object(h.d)((function(e){t.close(),y.logout()})),!1),t.addEventListener("Join",Object(h.d)((function(e){var t=JSON.parse(e.data);y.state.connectedUsers.find((function(e){return e.name===t.user}))||y.state.connectedUsers.push({name:t.user}),y.state.messages.push({timestamp:y.formatDate(t.created),message:" JOIN: "+t.user,id:e.id})})),!1),t.addEventListener("Message",Object(h.d)((function(e){var t=JSON.parse(e.data);console.log(t),y.state.messages.push({timestamp:y.formatDate(t.created),message:" ("+t.user+") "+t.message,id:e.id})})),!1),t.addEventListener("Part",Object(h.d)((function(e){var t=JSON.parse(e.data);for(var a in y.state.connectedUsers)y.state.connectedUsers[a].name==t.user&&y.state.connectedUsers.splice(a,1);y.state.messages.push({timestamp:y.formatDate(t.created),message:" PART: "+t.user,id:e.id})})),!1),t.addEventListener("ServerStatus",Object(h.d)((function(e){var t=JSON.parse(e.data);y.state.messages.push({timestamp:y.formatDate(t.created),message:" STATUS: "+t.status,id:e.id})})),!1),t.addEventListener("Users",Object(h.d)((function(e){y.state.connectedToChat=!0,y.state.connectedUsers=JSON.parse(e.data).users.map((function(e){return{name:e}}))})),!1),t.addEventListener("error",Object(h.d)((function(e){y.disconnect(),2==e.target.readyState?y.logout():console.log("Disconnected, retrying")})),!1)};var j=y,w=(a(49),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={username:"",password:"",hostname:"http://localhost:5000"},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"onSubmit",value:function(e){var t=this;v.API_Host=this.state.hostname,e.preventDefault();var a={username:this.state.username,password:this.state.password};f.a.post(v.API_Host+"/login",p.a.stringify(a),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(Object(h.d)((function(e){console.log("response from /login: "+JSON.stringify(e.data)),j.state.user={token:e.data.token,username:t.state.username,password:t.state.password},j.state.error=null}))).catch(Object(h.d)((function(e){console.log(e),e.response?j.state.error="failed to login, status code: "+e.response.status:j.state.error="Uh oh. Failed to connect to the host."})))}},{key:"onChange",value:function(e,t){var a=Object.assign({},this.state);a[e]=t.target.value,this.setState(a)}},{key:"render",value:function(){return s.a.createElement("div",{className:"loginformcontainer"},s.a.createElement("form",{onSubmit:this.onSubmit.bind(this)},s.a.createElement("h3",null,"Login"),s.a.createElement("span",null,"Hostname"),s.a.createElement("input",{name:"hostname",type:"text",onChange:this.onChange.bind(this,"hostname"),value:this.state.hostname}),s.a.createElement("span",null,"Username"),s.a.createElement("input",{name:"username",type:"text",onChange:this.onChange.bind(this,"username"),value:this.state.username}),s.a.createElement("br",null),s.a.createElement("span",null,"Password"),s.a.createElement("input",{name:"password",type:"text",onChange:this.onChange.bind(this,"password"),value:this.state.password}),s.a.createElement("br",null),s.a.createElement("input",{type:"submit"})))}}]),t}(s.a.Component)),S=Object(d.a)(w),C=(a(50),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={message:""},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"onMsgChange",value:function(e,t){var a=Object.assign({},this.state);a[e]=t.target.value,this.setState(a)}},{key:"onMsgSubmit",value:function(e){e.preventDefault(),this.props.sendMessage(this.state.message);var t=Object.assign({},this.state);t.message="",this.setState(t)}},{key:"render",value:function(){return s.a.createElement("form",{onSubmit:this.onMsgSubmit.bind(this)},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{type:"text",className:"form-control",placeholder:"message...","aria-label":"message","aria-describedby":"button-send",onChange:this.onMsgChange.bind(this,"message"),value:this.state.message}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"btn btn-outline-secondary",type:"submit",id:"button-send"},"Send"))))}}]),t}(s.a.Component)),N=Object(d.a)((function(){return s.a.createElement("div",{className:"container"},j.state.messages.map((function(e){return s.a.createElement("div",{className:"row message",key:e.timestamp+"-"+e.message},s.a.createElement("span",null,e.timestamp)," ",e.message)})))})),k=Object(d.a)((function(){return s.a.createElement("ul",null,j.state.connectedUsers.map((function(e){return s.a.createElement("li",{key:e.name},e.name)})))})),U=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={message:""},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){j.connectToChat(v.API_Host+"/stream/"+j.state.user.token)}},{key:"sendMessage",value:function(e){var t={message:e};f.a.post(v.API_Host+"/message",p.a.stringify(t),{headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer "+j.state.user.token}}).then(Object(h.d)((function(e){console.log("response from /message: "+JSON.stringify(e.data)),j.state.error=null}))).catch(Object(h.d)((function(e){console.log(e),j.state.error="failed to add message, status code: "+e.response.status})))}},{key:"render",value:function(){return s.a.createElement("div",{className:"container",style:{height:"100%"}},s.a.createElement("div",{className:"page-header"},s.a.createElement("h1",null,"CS291 Chat ",s.a.createElement("small",null," by Dana Nguyen and Gareth George")),s.a.createElement("br",null)),s.a.createElement("div",{className:"row",style:{height:"100%"}},s.a.createElement("div",{className:"col-md-10",style:{height:"100%"}},s.a.createElement("h2",null,"Messages"),s.a.createElement(N,null),j.state.connectedToChat?s.a.createElement(C,{sendMessage:this.sendMessage.bind(this)}):null),s.a.createElement("div",{className:"col-md-2",style:{height:"100%"}},s.a.createElement("div",{className:"usercontainer"},s.a.createElement("h2",null,"Users"),s.a.createElement(k,null)))))}}]),t}(s.a.Component),D=Object(d.a)(U),A=function(e){return e.error?s.a.createElement("div",{style:{borderStyle:"solid",borderColor:"red",padding:"0.25em",width:"100%"}},s.a.createElement("span",{style:{color:"red",fontSize:"2em"}},e.error)):s.a.createElement("div",null)},T=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={},a}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=null;return e=j.state.user?s.a.createElement("div",null,s.a.createElement(D,null)):s.a.createElement("div",null,s.a.createElement(S,null)),s.a.createElement("div",null,s.a.createElement(A,{error:j.state.error}),e)}}]),t}(s.a.Component),J=Object(d.a)(T);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[22,1,2]]]);
//# sourceMappingURL=main.8ee3268a.chunk.js.map